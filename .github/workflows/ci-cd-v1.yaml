name: Ci-cd pipeline
on:
    push:
        branches:
            - "main"
            - "feature*"
    pull_request:
        branches:
            - "main"
            - "release*"
            
jobs:
    test:
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-latest, centos-latest]
                version: [16,18]
        steps:
            - 
                name: checking out repo #not needed in my case but lets keep it
                uses: actions/checkout@v3
            -
                name: Setup node 
                uses: actions/setup-node@v3
                with:
                    node-version: ${{ matrix.version }}
            -
                name: install npm on runners
                run: |
                    npm install
            -
                name: test npm
                run: |
                    npm test 
    
    build_and_push:
        runs-on: ubuntu-latest
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        steps:
            -
                uses: actions/checkout@v3
            -  
                name: Login to Dockerhub
                uses: docker/login-action@v3
                with:
                    username: ${{ secrets.DOCKER_USERNAME }}
                    password: ${{ secrets.DOCKER_PASSWORD }}
            -
                name: Build and push
                uses: docker/build-push-action@v6
                with:
                    push: true
                    tags: user/app:latest